%!TEX root = ../../../_main.tex
\subsection{Residuums}
\label{sec:twisted-involutions-residuums}

\begin{defi}
	\typedlabel{defi:residuum}
	Let $w \in W$ and $I \subseteq S$ be a subset of generators. Then we define
	$$ wC_I := \{ w \ul s_1 \ldots \ul s_k : k \in \nn_0, s_i \in S \} $$
	as the \defword{$I$-residuum} of $w$ or just \defword{residuum}. To emphasize the size of $I$, say $|I| = n$, we also speak of a \defword{rank-$n$-residuum}.
\end{defi}

\begin{exam}
	Let $w \in W$. Then $wC_\emptyset = \{ w \}$ and $wC_S = \ti{\theta}$.
\end{exam}

\begin{lemm}
	\typedlabel{lemm:all-elements-of-one-residuum-yield-the-same-residuum}
	Let $w \in W$ and $I \subset S$. If $v \in wC_I$, then $vC_I = wC_I$.

	\begin{proof}
		Suppose $v \in wC_I$. Then $v = w \ul s_1 \ldots \ul s_n$ for some $s_i \in I$. Suppose $u = w \ul t_1 \ldots \ul t_m \in wC_I$ is any other element in $wC_I$ with $t_i \in I$. Then
		$$ u = w \ul t_1 \ldots \ul t_m = (v \ul s_n \ldots \ul s_1) \ul t_1 \ldots \ul t_m $$
		and so $u \in vC_I$. This yields $wC_I \subset vC_I$. Since $w \in vC_I$ we can swap $v$ and $w$ to get the other inclusion.
	\end{proof}
\end{lemm}

\begin{coro}
	Let $v, w \in W$ and $I \subset S$. Then either $vC_I \cap wC_I = \emptyset$ or $vC_I = wC_I$.

	\begin{proof}
		Immediately follows from \ref{lemm:all-elements-of-one-residuum-yield-the-same-residuum}.
	\end{proof}
\end{coro}

\begin{prop}
	\typedlabel{prop:residuums-have-unique-wk-theta-minimal-element}
	\theocite{Lemma 5.6}{hultman:comb-twisted-invo}
	Let $w \in \ti{\theta}$, $I \subseteq S$ be a set of generators. Then there exists a unique element $w_0 \in wC_I$ with $w_0 \preceq w_0 \ul s$ for all $s \in I$.

	\begin{proof}
		Suppose there is no such element. Then for each $w \in wC_I$ we can find a $s \in I$ with $w' = w \ul s \preceq w$ and $e' \in wC_I$. By repetition of \ref{prop:deletion-property-for-twisted-expressions} we get, that $e \in wC_I$, but $e$ has the property, which we assumed, that no element in $wC_I$ has. Hence there must be at least one such element. Now suppose there are two distinct elements $u,v$ with the desired property. Note that this means, that $u$ and $w$ have no reduced twisted expression ending with some $\ul s \in I$. Let $v$ have a reduced twisted expression $v = \ul s_1 \ldots \ul s_k$. Since $u$ and $v$ are both in $wC_I$ there must be a twisted $v$-expression for $u$
		$$ u = v \ul s_{k+1} \ldots \ul s_{k+l} = \ul s_1 \ldots \ul s_{k+l} $$
		with $s_n \in I$ for $k+1 \leq n \leq k+l$. This twisted expression cannot be reduced, since it ends with $\ul s_{k+l} \in I$. Then \ref{prop:deletion-property-for-twisted-expressions} yields that this twisted expression contains a reduced twisted subexpression for $u$. It cannot end with $\ul s_n$ for $k+1 \leq n \leq k+l$. Hence, it is a twisted subexpression of $\ul s_1 \ldots \ul s_k = v$, too. So $u \leq v$ by \ref{theo:bruhat-subexpression-characterization}. Because of symmetry we have $v \leq u$ and so $u = v$, contradicting to our assumption $u \neq v$.
	\end{proof}
\end{prop}

\begin{coro}
	\typedlabel{coro:residuums-have-unique-minimal-element}
	Let $w \in \ti{\theta}$, $I \subseteq S$ be a set of generators and let $\rho_{min} := \min \{ \rho(v) : v \in wC_I \}$ be the minimal twisted length within the residuum $wC_I$. Then there is a unique element $w_{min} \in wC_I$ with $\rho(w_{min}) = \rho_{min}$. We denote this element by $\min(w,I)$.

	\begin{proof}
		The minimal rank $\rho_{min}$ exists, since the image of $\rho$ is in $\nn_0$, which is well-ordered, and $wC_I \neq \emptyset$. Suppose we have an element $w_{min}$ with $\rho(w_{min}) = \rho_{min}$. This means, that in particular all $w_{min} \ul s$ with $s \in I$ must be of larger twisted length, i.e. $w_{min} < w_{min} \ul s$ for all $s \in I$. With \ref{prop:residuums-have-unique-wk-theta-minimal-element} this element must be unique.
	\end{proof}
\end{coro}

We proceed with some properties of rank-2-residuums. Our interest in these residuums stems from the fact, that their properties are needed later in Section \ref{sec:twisted-involutions-algorithms} to construct an effective algorithm for calculating the twisted weak ordering, i.e. calculating the Hasse diagram of $Wk(\theta)$ for arbitrary Coxeter systems $(W,S)$ and Coxeter system automorphisms $\theta$.

\begin{defi}
	Let $s,t \in S$ be two distinct generators. We define:
	$$[\ul s \ul t]^n :=
	\begin{cases}
	(\ul s \ul t)^{\frac{n}{2}} & n \textrm{ even}, \\
	(\ul s \ul t)^{\frac{n-1}{2}} \ul s & n \textrm{ odd}. 
	\end{cases}$$
\end{defi}

This definition allows us to express rank-2-residuums differently. Suppose we have an element $w \in \ti{\theta}$ and two distinct generators $s,t \in S$. Thanks to \ref{lemm:all-elements-of-one-residuum-yield-the-same-residuum} and \ref{coro:residuums-have-unique-minimal-element} we can assume, that $w = min(w,\{s,t\})$. Then
$$ wC_{\{s,t\}} = \{ w \} \ \cup \ \{ w [\ul s \ul t]^n : n \in \nn \} \ \cup \ \{ w [\ul t \ul s]^n : n \in \nn \}. $$
This encourages the following definition.

\begin{defi}
	Let $w \in \ti{\theta}$ and let $s,t \in S$ be two distinct generators. Suppose $w = min(w,\{s,t\})$. Then we call $\{ w [\ul s \ul t]^n : n \in \nn \}$ the \defword{$s$-branch} and $\{ w [\ul t \ul s]^n : n \in \nn \}$ the \defword{$t$-branch} of $wC_{\{s,t\}}$.
\end{defi}

One question arises immediately: Are the $s$- and the $t$-branch disjoint? With the following propositions, corollaries and lemmas we will get a much better idea of the structure of rank-2-residuums and answer this question.

\begin{prop}
	\typedlabel{prop:rank-2-residuums-are-convex}
	Let $w \in W$ and let $s,t \in S$ be two distinct generators. Without loss of generality suppose $w = \min(w, \{s,t\})$. If there is a $v \in wC_{\{s,t\}}$ with $v \ul s \prec v$ and $v \ul t \prec v$, then it is unique with this property in $wC_{\{s,t\}}$. Hence $wC_{\{s,t\}}$ consists of two geodesics from $w$ to $v$ intersecting only in these two elements. Else, the $s$- and $t$-branch are disjoint, strictly ascending in twisted length and of infinite size.

	\begin{proof}
		Suppose there is a $v$ in the $s$-branch with $v \ul s \prec v$ and $v \ul t \prec v$, say $v = w[\ul s \ul t]^n$ and $n$ is minimal with this property. Because of the uniqueness of a minimal element from \ref{prop:residuums-have-unique-wk-theta-minimal-element} we have $w[\ul s \ul t]^{m+1} \prec w[\ul s \ul t]^m$ for all $m \in \nn$ with $n \leq m \leq 2n - 1$. With the same argument we have $w[\ul s \ul t]^{2n} = w$. If no such $v$ exists, then the $s$- and $t$-branch must be disjoint, strictly ascending in twisted length and so of infinite size.
	\end{proof}
\end{prop}

\begin{prop}
	\typedlabel{prop:onesided-operations-only-at-top-or-bottom-end-of-twocycle}
	Let $w \in S$ and $s,t \in S$ be two distinct generators. If $\ul s$ acts by multiplications on $w$ and $w \ul s \prec w$, then either $w \ul s \ul t \prec w \ul s$ or $w \ul t \succ w$.

	\begin{proof}
		We have $\theta(s)ws = w$ and $s \in D_R(w)$, hence $w \ul s \leq w$. If $t \notin D_R(w)$ or $t \in D_R(w \ul s)$, then we are done. In return suppose $t \in D_R(w)$ and $t \notin D_R(w \ul s)$. Then we have $w \ul t \leq w$ and $w \ul s \leq w \ul s \ul t$. With the second part of \ref{lemm:lifting-property-for-ul-s} we conclude $(w \ul s \ul t) \ul t \leq w \ul t$. This yields
		$$ ws = w \ul s = (w \ul s \ul t) \ul t \leq w \ul t. $$
		Since $l(w) - 1 = l(w \ul s) \leq l(w \ul t) < l(w)$ we have $w \ul t = wt$, hence $ws \leq wt$. But $s,t \in D_R(w)$ and so $l(ws) = l(wt)$ and $ws = wt$, too. Therefore $s = t$, contradicting our assumption of two distinct generators.
	\end{proof}
\end{prop}

\begin{coro}
	\typedlabel{coro:onesided-operations-only-at-top-or-bottom-end-of-twocycle}
	Let $w \in S$ and let $s,t \in S$ be two distinct generators. If $w$ is neither $\min(w,\{s,t\})$, nor a maximal element in $wC_{\{s,t\}}$, then both $\ul s$ and $\ul t$ act by twisted conjugation on $w$.

	\begin{proof}
		Follows immediately from \ref{prop:onesided-operations-only-at-top-or-bottom-end-of-twocycle}.
	\end{proof}
\end{coro}

\begin{lemm}
	\typedlabel{lemm:one-both-sided-action-symmetric-in-rank-2-residuums}
	Let $s,t \in S$ be two distinct generators and $w \in S$ with $w = min(w,\{s,t\})$. Suppose $v \in wC_{\{s,t\}}$ with $v \ul s \prec v$ and $v \ul t \prec v$. Then the twisted conjugations and mulitplications are distributed axisymmetrically or pointsymmetrically like in Figure \ref{fig:dist-one-bothsided-actions-in-rank-2-residuum}.

	\begin{figure}[ht]
		\centering
		\input{resources/tikz/one-bothsided-symmetry-0000}
		\input{resources/tikz/one-bothsided-symmetry-1111}
		\input{resources/tikz/one-bothsided-symmetry-1100}
		\input{resources/tikz/one-bothsided-symmetry-0011}
		\input{resources/tikz/one-bothsided-symmetry-1010}
		\input{resources/tikz/one-bothsided-symmetry-0101}
		\caption{Possible distributions of twisted conjugations and multiplications in finite rank-2-residuums}
		\label{fig:dist-one-bothsided-actions-in-rank-2-residuum}
	\end{figure}

	\begin{proof}
		If $u$ covers $w$, then there are only two edges and the assumption holds. So suppose $wC_{\{s,t\}}$ contains at least four edges. Due to \ref{coro:onesided-operations-only-at-top-or-bottom-end-of-twocycle} the actions by multiplication can only occure next to $w$ and $v$. Hence there are $2^4 = 16$ configurations possible. \ref{prop:geodesics-have-same-count-of-multiplicative-steps} wipes out ten out of the 16 configurations. The remaining are those from Figure \ref{fig:dist-one-bothsided-actions-in-rank-2-residuum}.
	\end{proof}
\end{lemm}

\begin{exam}
	In Figure \ref{fig:a4_s1s3-and-a4_s2s4} we see two Hasse diagrams of $Wk(A_4, \id)$. The left one only contains edges with labels $s_1,s_2$, the middle one only edges with labels $s_1,s_3$ and the right one only edges with labels $s_1,s_4$.
	\begin{figure}[ht]
		\centering
		\input{resources/tikz/a4_s1s2}
		\quad \quad
		\input{resources/tikz/a4_s1s3}
		\quad \quad
		\input{resources/tikz/a4_s1s4}
		\caption{Hasse diagrams of $Wk(A_4, \id)$ after removing $s_3,s_4$ edges in the left, $s_2,s_4$ edges in the middle and $s_2,s_3$ edges in the right diagram}
		\label{fig:a4_s1s3-and-a4_s2s4}
	\end{figure}
\end{exam}

\begin{lemm}
	\typedlabel{lemm:max-twisted-circle-height}
	Let $w \in S$, $s,t \in S$ be two distinct generators and $m = \ord(st) < \infty$. Then $|wC_{\{s,t\}}| \leq 2m$.

	\begin{proof}
		Let $w$ be the $Wk$-minimal element and $v$ be the $Wk$-maximal element in our residuum. Due to \ref{lemm:one-both-sided-action-symmetric-in-rank-2-residuums} there are six different cases we have to consider. We handle the cases in Figure~\ref{fig:dist-one-bothsided-actions-in-rank-2-residuum} from left to right:
		\begin{description}
			\item[First:] We have $w (\ul s \ul t)^m = (ts)^m w (st)^m = w$.
			\item[Second:] Due to $\theta(s)w = ws$ and $\theta(t)w = wt$ we have
			$$ w (\ul s \ul t)^{m/2+1} = \theta(\hat t (st)^{m/2-1} \hat s) w (st)^{m/2+1} = w(st)^m = w. $$
			It is still remaining to show, that this case can only occur for even $m$. \todo
			\item[Third:] Again we are in a case, where $\theta(s)w = ws$ and $\theta(t)w = wt$ hold. Hence we have
			$$ w (\ul s \ul t)^{(m+1)/2} = \theta(\hat t (st)^{(m-1)/2} \hat s) w (st)^{(m+1)/2} = w(st)^m = w. $$
			It is still remaining to show, that this case can only occur for odd $m$. \todo
			\item[Fourth:] Analogue to the previous case, if we start from $u$ instead of $w$.
			\item[Fifth:] Suppose $m$ is even. Then we have
			$$ w (\ul s \ul t)^m = \theta(\underbrace{ts \cdots st}_{m-1} \hat s \underbrace{ts \cdots st}_{m-1} \hat s) w (st)^m = \theta(\underbrace{ts \cdots s}_{m-2} \underbrace{s \cdots st}_{m-2}) w = \ldots = w. $$
			If $m$ is odd, then we have the completely analogue situation
			$$ w (\ul s \ul t)^m = \theta(\underbrace{ts \cdots ts}_{m-1} \hat t \underbrace{st \cdots st}_{m-1} \hat s) w (st)^m = \theta(\underbrace{ts \cdots t}_{m-2} \underbrace{t \cdots st}_{m-2}) w = \ldots = w. $$
			\item[Sixst:] Analogue to the previous case due to symmetry.
		\end{description}
		So in all six cases we have $w (\ul s \ul t)^k = w$ for a $k \leq \ord(st)$ and hence the residuum can have at most $2 \cdot \ord(st)$ many distinct elements.
	\end{proof}
\end{lemm}

\begin{prop}
	Let $w \in S$ and $s,t \in S$ be two distinct generators with $w \ul s \neq w \ul t$. Suppose $w = w(\ul s \ul t)^m = w(\ul s \ul t)^n$. Then $\gcd(m,n) > 1$.

	\begin{proof}
		Suppose $k$ to be the smallest positive integer with $w = w(\ul s \ul t)^k$. Note, that since we assumed $w \ul s \neq w \ul t$ we have $k > 1$. Let $n$ be another positive integer with the same property, say $n = qk + r$ for $q \in \nn_0$ and $r \in \{0,\ldots,k-1\}$. Then
		$$ w(\ul s \ul t)^n = w(\ul s \ul t)^{qk+r} = w((\ul s \ul t)^k)^q (\ul s \ul t)^r = w(\ul s \ul t)^r. $$
		For $r > 0$ we would have a contradiction to the minimality of $k$, hence $r = 0$, $q > 0$ and therefore $n = qk$. So any $n \in \nn$ satisfying the desired property is a multiple of k, hence for two arbitrary $m,n \in \nn$ with the desired property we have $\gcd(m,n) \geq k > 1$.
	\end{proof}
\end{prop}